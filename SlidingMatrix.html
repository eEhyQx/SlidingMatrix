<!DOCTYPE html>
<html>
<head>
    <title>Sliding Matrix</title>
    <style>
        canvas{
            display: block;
            margin: 0 auto;
            border-radius: 50px;
            background-color: #00FFFF;
        }
    </style>
</head>
<body bgcolor="#f67c5f">
    <center id="steps" style="font:bold 25px Arial,Microsoft Yahei"></center><br/>
    <canvas id="canvas" width="500" height="500"></canvas>
    
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext('2d');
        var map_degree=4;
        var map;
        var num_color = {0:"#ccc0b3",2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#ec6544",128:"#e44d29",256:"#edcf72",512:"#c8a145",1024:"#a8832b",2048:"#86aa9c"};
        var num_size = {0:"60",2:"60",4:"60",8:"60",16:"60",32:"60",64:"60",128:"50",256:"50",512:"50",1024:"40",2048:"40"};
        var offsetx = {0:53,2:53,4:53,8:53,16:34,32:35,64:35,128:28,256:28,512:28,1024:24,2048:25};
        var keycom = {'38':[0,-1],'40':[0,1],'37':[-1,0],'39':[1,0]};
        var space=16,score=0; 

        //add two vars below to replace the map of size and color
        var default_color="#ccc0b3";
        var default_num_size="60";

        //add var stepcounter
        var stepcount=0;

        //add function get_map_degree
        function get_map_degree(){
            map_degree=prompt("Please choose the degree of the matrix:(positive integer)","4"); 
            return map_degree;           
        }
        map_degree=Number(get_map_degree());
        alert ("map_degree="+String(map_degree));  
        canvas.width=125*map_degree;
        canvas.height=125*map_degree;
        map=createmap(map_degree);
        draw();
        
        //the controll logic:
        //There are 8 different input: w,a,s,d,up,left,down,right
        //wasd controlls central element
        //arrwos controlls the slides of the matrix; 
        
        function createmap(degree){
            var map=new Array();
            for(var i=0;i<degree;i++){
                map[i]=new Array();
                for(var j=0;j<degree;j++){
                    map[i][j]=0;
                }
            }
            return map;
        }
        function draw(){
            formap(function(i,j){
                    var num = map[i][j];
                    ctx.fillStyle = default_color;
                    ctx.fillRect(j*120+20,i*120+20,100,100);
                    if(num!=0){
                        ctx.font = "bold "+default_num_size+"px Arial,Microsoft Yahei";
                        ctx.fillStyle = (num<=map_degree)?"#776e65":"white";
                        ctx.fillText(String(map[i][j]),j*120+offsetx[num],i*120+70+num_size[num]/3);
                    }
                    console.log("draw: "+i+","+j);
                });
            document.getElementById("steps").innerText="steps: "+String(stepcount+1);
        }


        function formap(func){
            for(var i=0;i<map_degree;i++)
                for(var j=0;j<map_degree;j++){
                    func(i,j);
                }
        }
     

        function move(dir){
            
            if(space==0)alert("game over");
            draw();
        }

        produce();produce();

        document.onkeydown=function(e){
            
        };
        var sx,sy,dx,dy,ex,ey;
        canvas.ontouchstart=function(event){
            
        }
        canvas.ontouchmove=function(event){
        }
        canvas.ontouchend=function(event){
        }

        

    </script>
</body>
</html>
        