<!DOCTYPE html>
<html>
<head>
    <title>Sliding Matrix</title>
    <style>
        canvas{
            display: block;
            margin: 0 auto;
            border-radius: 10px;
            background-color: #00FFFF;
        }
    </style>
</head>
<body bgcolor="#f67c5f">
    <center id="steps" style="font:bold 25px Arial,Microsoft Yahei"></center><br/>
    <canvas id="canvas" width="500" height="500"></canvas>
    
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext('2d');
        var map_degree=4;
        var map;
        var offsetx = {1:53,2:34,3:28,4:25};
        var keycom = {'87':[-1,0],'83':[1,0],'65':[0,-1],'68':[0,1],'74':[0,0,0],'75':[0,0,1],'76':[0,0,-1]}; 
        //up,down,left,right,j,k,l
        //add row and colomn move
        var row_move=0;
        var col_move=0;
        var reverse=false;
        
        var default_color="#ccc0b3";
        var core_color="#008000";
        var default_num_size={1:60,2:60,3:50,4:40};
        var stepcount=0;
        var core_position=[0,0];

        var step_documents=new Array();
        step_documents[0]=['num','row_or_col','times'];

        //add function get_map_degree
        function get_map_degree(){
            map_degree=prompt("Please choose the degree of the matrix:(positive integer)","4"); 
            return map_degree;           
        }
        
        //the controll logic:
        //There are 8 different input: w,a,s,d,up,left,down,right
        //wasd controlls central element
        //arrwos controlls the slides of the matrix; 
        
        function createmap(degree){
            var map=new Array();
            for(var i=0;i<degree;i++){
                map[i]=new Array();
                for(var j=0;j<degree;j++){
                    map[i][j]=1+i*degree+j;
                }
            }
            return map;
        }

        function draw(){
            formap(function(i,j){
                    var num = map[i][j];
                    if (i==core_position[0] && j==core_position[1]){
                        ctx.fillStyle=core_color;
                    }
                    else{
                        ctx.fillStyle=default_color;
                    }
                    ctx.fillRect(j*120+20,i*120+20,100,100);
                    ctx.font = "bold "+default_num_size[String(num).length]+"px Arial,Microsoft Yahei";
                    ctx.fillStyle = "#776e15";
                    ctx.fillText(String(num),j*120+offsetx[String(num).length],i*120+70+default_num_size[String(num).length]/3);
                    console.log("draw: "+i+","+j);
                });
            document.getElementById("steps").innerText="steps: "+String(stepcount);
        }

        function formap(func){
            for(var i=0;i<map_degree;i++)
                for(var j=0;j<map_degree;j++){
                    func(i,j);
                }
        }
     
        function move(x,direction,reverse=false){
            if(direction){
                var tmp=map[map_degree-1][x];
                for(i=0;i<map_degree-1;i++){
                    map[map_degree-i-1][x]=map[map_degree-i-2][x];
                }
                map[0][x]=tmp;
            }
            else{
                var tmp=map[x][map_degree-1];
                for(i=0;i<map_degree-1;i++){
                    map[x][map_degree-i-1]=map[x][map_degree-i-2];
                }
                map[x][0]=tmp;
            }
            
        }
        //j(true) means row-move and k(false) means colomn-move
        
                       
        /* ;*/
        function core_location(input){
            core_position[0]+=keycom[input][0];
            core_position[0]=(core_position[0]+map_degree)%map_degree;
            core_position[1]+=keycom[input][1];
            core_position[1]=(core_position[1]+map_degree)%map_degree;
            if (keycom[input].length==3){
                command=keycom[input][2];
                return command;
            }
            else return null;
        } 
        
        //produce();produce();
        document.onkeydown=function(e){
            dir =(e?e:event).keyCode;
            console.log(dir);
            cmd=core_location(dir);
            if (cmd!=null){

                move(core_position[cmd],cmd,false);
            }
            draw();
        };

        function is_neat(){
            ans=true;
            for (var i=0;i<map_degree;i++){
                for (var j=0;j<map_degree;j++){
                    if ((i*map_degree+j)!=map[i][j]){
                        ans=false;
                        break;
                    }   
                }
                if (ans==false) break;
            };
            return ans;
        }
        /*def judge(*state):
    l=len(state)
    n=l**0.5
    s=1
    if n!=int(n):
        print "not a square!"
        return
    if set(state)!=set(range(0,l)):
        print "data error!"
        return
    if n%2==0:
        print True
        return
    for i in range(0,l):
        for j in range(0,l):
            if i>j:
                s*=(state[i]-state[j])
    print s>0
*/
        //try to prove the existence of solution
        function has_solution(){
            ans=true;
            return ans;            
        }

        
        var sx,sy,dx,dy,ex,ey;
        canvas.ontouchstart=function(event){
            
        }
        canvas.ontouchmove=function(event){
        }
        canvas.ontouchend=function(event){
        }

        map_degree=Number(get_map_degree());
        alert ("map_degree="+String(map_degree));  
        canvas.width=20+120*map_degree;
        canvas.height=20+120*map_degree;
        map=createmap(map_degree);
        draw();        

    </script>
</body>
</html>
        